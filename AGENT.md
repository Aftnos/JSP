# AI 编码 Agent 指南

本指南旨在帮助 AI 编码助手（如 OpenAI Codex、GitHub Copilot 等）在本项目中高效协作与开发。文档包括项目目标、当前问题、编码守则、提示词策略以及未来扩展建议。

## 1. 项目目标与背景

* **目标**：构建一个轻量级 JSP 网页商城，突出 SN 码绑定机制，作为 JSP/Servlet 开发和 AI 编码协作的教学示例。
* **技术栈**：JSP + Java1.8 + Tomcat9.0.106 + MySQL8。无额外框架，前端仅 HTML/CSS/JS + JSP。
* **特色**：每件商品由“订单号（8 位十六进制）+ 商品 ID”生成唯一 SN 码，用户绑定后可申请售后。所有后端功能以静态方法形式封装在 `ServiceLayer.java`，JSP 直接调用。

## 2. 当前系统存在的问题

1. **SN 绑定逻辑不完善**：

   * 未验证商品 ID 是否属于指定订单。
   * 绑定记录无唯一性约束，可能重复绑定。
2. **静态方法接口不完整**：

   * 缺少 SN 有效性检查或快速查询接口。
   * 返回值仅为字符串，信息量有限。
3. **权限控制缺失**：

   * 后台管理路径未加过滤，任何用户可访问。
   * 缺少会话/角色校验。
4. **前端交互简陋**：

   * 无专门 SN 绑定入口页面。
   * 售后进度查看界面不友好。
5. **潜在异常处理不足**：

   * 并发下单、资源关闭等场景未充分考虑。

## 3. 编写指导守则

### 3.1 后端接口封装

* **三层流程**：DAO → Model → ServiceLayer。
* **位置**：所有对 JSP 调用的方法，均为 `ServiceLayer.java` 中的 `public static` 方法。JSP 不可直接访问 DAO。
* **返回值**：统一使用字符串 `"success"` 表示成功，其他字符串指示错误原因。

### 3.2 页面与前端约定

* **技术限制**：仅使用 HTML/CSS/JS + JSP，禁止引入 React/Vue 等框架。
* **交互方式**：表单提交调用后端，使用 JSP 表达式或脚本展示结果。
* **示例**：SN 绑定页面包含输入框和提交按钮，表单 action 调用绑定接口，并在同页显示 `绑定成功` 或错误消息。

### 3.3 SN 码绑定核心要求

1. **唯一性**：查询 `user_products` 表，确保同一订单号+商品 ID 组合不存在。
2. **正确性**：先通过 `OrderDAO.getOrderByNo(orderNo)` 获取订单，再检查订单项包含 `productId`。
3. **安全性**：userId 必须与 session 中登录用户一致，防止篡改。

### 3.4 代码风格与规范

* **命名**：驼峰法，语义清晰，方法名与现有模式对齐。
* **注释**：新增方法需添加 Javadoc 注释。
* **异常处理**：DAO 使用 try-with-resources，ServiceLayer 捕获异常并返回用户友好提示。
* **资源管理**：确保数据库连接、语句正确关闭。

### 3.5 测试与验证习惯

* 分步提示 Agent 编写代码并运行对应测试用例。
* 使用项目自带 `ServiceLayerTest` 或新增测试场景验证功能。

## 4. 编程提示词策略

1. **明确需求与位置**：指定文件、方法名及用途。
2. **提供上下文**：引用相关代码结构或伪代码片段。
3. **分步引导**：将复杂任务拆解为若干小步骤。
4. **示例输入/输出**：给出示例数据或格式。
5. **安全与性能要求**：强调预编译、SQL 注入防护等。
6. **错误修正**：定位问题，提示 Agent 进行局部修复。
7. **使用项目术语**：保持术语一致性。

## 5. 未来扩展建议

* **SN 码入口优化**：在用户中心和首页提供专门入口，支持未登录查询。
* **权限控制**：为 `/admin/*` 加过滤器，区分超级管理员与普通管理员角色。
* **售后流程完善**：添加申请类型、备注、日志记录及物流对接接口。
* **商品丰富度**：实现图片上传、用户评论功能。
* **UI 美化**：可引入 Bootstrap CSS 美化页面，保持 JSP 用法不变。
* **架构演进**：渐进引入 Servlet 处理器，或 ORM 框架。

---

> 此文档面向 AI 编码助手，帮助其理解项目背景与规范，生成符合风格的代码，并在协作中保持高效与质量。
